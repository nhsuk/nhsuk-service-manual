{% extends "layouts/layout.njk" %}

{% set pageTitle = "Search" %}
{% set disableSearch = true %}

{% if results | length %}
  {% set pageTitle = "Search results for " ~ query %}
{% elif query is string %}
  {% set pageTitle = "No results for " ~ query if query else "No results" %}
{% endif %}

{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">
      <form class="app-search" action="/search/" method="get" novalidate>
        {% call fieldset({
          legend: {
            text: pageTitle,
            size: "xl",
            classes: "nhsuk-u-margin-bottom-7",
            isPageHeading: true
          },
          classes: "app-component-reading-width"
        }) %}
          {{ input({
            label: {
              text: "Search the NHS digital service manual",
              classes: "nhsuk-u-visually-hidden"
            },
            name: "q",
            value: query,
            id: "search-results-field",
            classes: "app-search__input nhsuk-u-width-full",
            autocomplete: "off",
            attributes: {
              placeholder: "Search"
            },
            formGroup: {
              classes: "nhsuk-u-width-one-half",
              afterInput: {
                html: button({
                  html: nhsukIcon("search", { title: "Submit" }),
                  classes: "app-search__submit nhsuk-button--small"
                })
              }
            }
          }) }}
        {% endcall %}
      </form>
    </div>
  </div>
  {% if results | length or query is string %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">
    {% if results | length %}
      <p class="nhsuk-u-margin-bottom-4">
        1 â€“ {{ results | length }} of {{ resultsLen }} results for "{{ query }}"
      </p>

      <ul class="nhsuk-list nhsuk-list--border">
      {% for item in results %}
        <li>
          {% if item.parent %}<span class="app-search-results-category">{{ item.parent }}</span>{% endif %}
          <a class="app-search-results-item" href="{{ item.url }}">{{ item.title }}</a>
          <p class="nhsuk-body-s">{{ item.description }}</p>
        </li>
      {% endfor %}
      </ul>

      {% if maxPage > 1 %}
      {{ pagination({
        previous: {
          labelText: (currentPage - 1) ~ " of " ~ maxPage,
          href: "/search/?q=" ~ query ~ "&page=" ~ (currentPage - 1)
        } if currentPage != 1,
        next: {
          labelText: (currentPage + 1) ~ " of " ~ maxPage,
          href: "/search/?q=" ~ query ~ "&page=" ~ (currentPage + 1)
        } if currentPage != maxPage
      }) }}
      {% endif %}
    {% elif query is string %}
      <p>You could try:</p>
      <ul>
        <li>check your spelling</li>
        <li>use fewer keywords</li>
        <li>search for something less specific</li>
      </ul>
    {% endif %}
    </div>
  </div>
  {% endif %}
{% endblock %}
